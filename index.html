<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="data:;base64,=">
  </head>

  <body>
    <script type="module">
      import { Client } from './muxado.js';

      const session = new Client({
        serverDomain: "anderspitman.net",
        token: "yolo",
      });

      const enc = new TextEncoder('utf8');

      let windowSize = 256*1024;

      session.onAccept((stream) => {
        console.log("got stream", stream);

        stream.onData((data) => {
          console.log("got data", data);
          console.log(new TextDecoder('utf8').decode(data));

          const msg = enc.encode("HTTP/1.1 200\nContent-Length: 8\n\nHi there");

          if (msg.length < windowSize) {
            stream.write(msg);
          }
        });

        stream.onWindowIncrease((windowIncrease) => {
          console.log("windowIncrease", windowIncrease);
        });
      });

    </script>
  </body>
</html>
